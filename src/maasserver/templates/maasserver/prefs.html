{% extends "maasserver/base.html" %}

{% block nav-active-prefs %}active{% endblock %}
{% block title %}User preferences for {{ user.username }}{% endblock %}
{% block page-title %}User preferences for {{ user.username }}{% endblock %}
{% block layout-modifiers %}sidebar{% endblock %}

{% block head %}
  <script type="text/javascript">
  <!--
  YUI().use('maas.prefs', function (Y) {
    var profile_widget = new Y.maas.prefs.TokenWidget(
        {'srcNode': Y.one('#api')});
    profile_widget.render();
  });
  // -->
  </script>
{% endblock %}

{% block content %}
  <div id="prefs">
    <div id="api">
      <h2>MaaS keys</h2>
      <p>
        An API token is the information you need to provide to a third
        party application for it to be able to access the MaaS server
        <a href="{% url 'api-doc' %}">API</a> on your behalf.
      </p>
      <p>
        You can create as many API tokens as you require.
      </p>
      <table class="list">
        <thead>
          <tr>
            <th>APIÂ tokens</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for token in user.get_profile.get_authorisation_tokens %}
          <tr class="bundle">
            <td id="{{ token.key }}">
              {{ token.consumer.key }}:{{ token.key }}:{{ token.secret }}</td>
            <td>
              <a href="#" class="delete-link">
                <img title="Delete token"
                     src="{{ STATIC_URL }}img/delete.png" />
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <p id="token_creation_placeholder" />
    </div>
    <div id="profile">
      <h2>User details</h2>
      <form action="." method="post">
        <ul>
          {% for field in profile_form %}
            {% include "maasserver/form_field.html" %}
	  {% endfor %}
	</ul>
        <input type="hidden" name="profile_submit" value="1" />
        <input type="submit" class="button right" value="Save" />
        <div class="clear" />
      </form>
    </div>
    <div id="password">
      <h2>Password</h2>
      <form action="." method="post">
        <ul>
          {% for field in password_form %}
            {% include "maasserver/form_field.html" %}
          {% endfor %}
        </ul>
        <input type="hidden" name="password_submit" value="1" />
        <input type="submit" class="button right" value="Change password" />
        <div class="clear" />
      </form>
    </div>
  </div>
{% endblock %}
