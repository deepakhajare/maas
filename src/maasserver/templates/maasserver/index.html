{% extends "maasserver/base.html" %}

{% block nav-active-index %}active{% endblock %}
{% block title %}Dashboard{% endblock %}
{% block site-switcher %}{% endblock %}

{% block html_includes %}{% include "maasserver/snippets.html" %}
{% endblock %}

{% block head %}
  <script type="text/javascript" src="{{ STATIC_URL }}jslibs/raphael/raphael-min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/nodes_chart.js"></script>
  <script type="text/javascript">
  <!--
  YUI().use(
    'maas.node_add', 'maas.node','maas.node_views', 'maas.utils', 'maas.nodes_chart',
    'maas.longpoll', 
    function (Y) {
    Y.on('load', function() {
      // Create Dashboard view.
      var view_container = Y.Node.create('<div />')
          .set('id', 'dashboard');
      Y.one('#content').append(view_container);
      var view = new Y.maas.node_views.NodesDashboard(
          {'append': '#dashboard'});
      view.render(view_container);
      // Create 'Add node' link.
      var add_node_link = Y.Node.create('<a />')
          .set('id', 'addnode')
          .set('text', "Add node")
          .set('href', '#')
          .addClass('button');
      Y.one('#content').append(add_node_link);
      add_node_link.on('click', Y.maas.node_add.showAddNodeWidget);

      // Setup TitleEditWidget.
      var title_widget = new Y.maas.utils.TitleEditWidget(
	  {srcNode: '.page-title-form'});
      title_widget.render();


      // Show the chart
      var cfg = {
        node_id: 'chart',
        width: 300
        };
      var chart = new Y.maas.nodes_chart.NodesChartWidget(cfg);

      // Sample event listeners.
      Y.on("Node.updated", function() {
		  Y.log("node updated");
      });

      Y.on("Node.created", function() {
		  Y.log("node created");
      });

      Y.on("Node.deleted", function() {
		  Y.log("node deleted");
      });

      // Start longpoll.
      {% if longpoll_queue and LONGPOLL_PATH %}
        Y.later(0, Y.maas.longpoll, function() {
          var longpollmanager = Y.maas.longpoll.setupLongPollManager(
            '{{ longpoll_queue }}', '{{ LONGPOLL_PATH }}');
        });
      {% endif %}

    });
  });
  // -->
  </script>
{% endblock %}

{% block page-title-block %}
  {% if user.is_superuser %}
    <form action="" method="" class="page-title-form">
      <input type="text" value="{{ global_options.site_name }} MAAS"
             title="Edit the name of this MAAS" />
    </form>
  {% else %}
    <h1 id="page-title">{% include "maasserver/site_title.html" %}</h1>
  {% endif %}
{% endblock %}

{% block content %}
    <div id="chart"></div>
{% endblock %}
